---
- job:
    name: propose-network-collections-migration-base
    parent: propose-github-updates
    run:
      - tests/playbooks/run-pre.yaml
      - tests/playbooks/run.yaml
      - tests/playbooks/run-post.yaml
    post-run: tests/playbooks/post.yaml
    required-projects:
      - name: github.com/ansible/ansible
      - name: github.com/ansible-network/collection_migration
        override-checkout: feature/network-collections
      - name: github.com/ansible-network/network_collections_migration
    timeout: 3600
    nodeset: fedora-latest-1vcpu
    vars:
      ansible_collection_repo: "github.com/ansible-collections/{{ ansible_collection_name }}"

- job:
    name: propose-network-collections-migration-base
    parent: unittests

- job:
    name: propose-network-collections-migration-ansible-netcommon
    parent: propose-network-collections-migration-base
    required-projects:
      - name: github.com/ansible-collections/netcommon
    vars:
      ansible_collection_namespace: ansible
      ansible_collection_name: netcommon
      proposal_project_src: ~/src/github.com/ansible-collections/netcommon

- job:
    name: propose-network-collections-migration-cisco-asa
    parent: propose-network-collections-migration-base
    required-projects:
      - name: github.com/ansible-collections/asa
    vars:
      ansible_collection_namespace: cisco
      ansible_collection_name: asa
      proposal_project_src: ~/src/github.com/ansible-collections/asa

- job:
    name: propose-network-collections-migration-arista-eos
    parent: propose-network-collections-migration-base
    required-projects:
      - name: github.com/ansible-collections/eos
    vars:
      ansible_collection_namespace: arista
      ansible_collection_name: eos
      proposal_project_src: ~/src/github.com/ansible-collections/eos

- job:
    name: propose-network-collections-migration-checkpoint-checkpoint
    parent: propose-network-collections-migration-base
    required-projects:
      - name: github.com/ansible-collections/checkpoint
    vars:
      ansible_collection_namespace: checkpoint
      ansible_collection_name: checkpoint
      proposal_project_src: ~/src/github.com/ansible-collections/checkpoint

- job:
    name: propose-network-collections-migration-cisco-ios
    parent: propose-network-collections-migration-base
    required-projects:
      - name: github.com/ansible-collections/ios
    vars:
      ansible_collection_namespace: cisco
      ansible_collection_name: ios
      proposal_project_src: ~/src/github.com/ansible-collections/ios

- job:
    name: propose-network-collections-migration-cisco-iosxr
    parent: propose-network-collections-migration-base
    required-projects:
      - name: github.com/ansible-collections/iosxr
    vars:
      ansible_collection_namespace: cisco
      ansible_collection_name: iosxr
      proposal_project_src: ~/src/github.com/ansible-collections/iosxr

- job:
    name: propose-network-collections-migration-cisco-nxos
    parent: propose-network-collections-migration-base
    required-projects:
      - name: github.com/ansible-collections/nxos
    vars:
      ansible_collection_namespace: cisco
      ansible_collection_name: nxos
      proposal_project_src: ~/src/github.com/ansible-collections/nxos

- job:
    name: propose-network-collections-migration-frr-frr
    parent: propose-network-collections-migration-base
    required-projects:
      - name: github.com/ansible-collections/frr
    vars:
      ansible_collection_namespace: frr
      ansible_collection_name: frr
      proposal_project_src: ~/src/github.com/ansible-collections/frr

- job:
    name: propose-network-collections-migration-junipernetworks-junos
    parent: propose-network-collections-migration-base
    required-projects:
      - name: github.com/ansible-collections/junos
    vars:
      ansible_collection_namespace: junipernetworks
      ansible_collection_name: junos
      proposal_project_src: ~/src/github.com/ansible-collections/junos

- job:
    name: propose-network-collections-migration-openvswitch-openvswitch
    parent: propose-network-collections-migration-base
    required-projects:
      - name: github.com/ansible-collections/openvswitch
    vars:
      ansible_collection_namespace: openvswitch
      ansible_collection_name: openvswitch
      proposal_project_src: ~/src/github.com/ansible-collections/openvswitch

- job:
    name: propose-network-collections-migration-skydive-skydive
    parent: propose-network-collections-migration-base
    required-projects:
      - name: github.com/ansible-collections/skydive
    vars:
      ansible_collection_namespace: skydive
      ansible_collection_name: skydive
      proposal_project_src: ~/src/github.com/ansible-collections/skydive

- job:
    name: propose-network-collections-migration-vyos-vyos
    parent: propose-network-collections-migration-base
    required-projects:
      - name: github.com/ansible-collections/vyos
    vars:
      ansible_collection_namespace: vyos
      ansible_collection_name: vyos
      proposal_project_src: ~/src/github.com/ansible-collections/vyos

- job:
    name: network-collections-migration-base
    parent: unittests
    pre-run: tests/playbooks/pre.yaml
    run:
      - tests/playbooks/run-pre.yaml
      - tests/playbooks/run.yaml
      - tests/playbooks/run-post.yaml
    required-projects:
      - name: github.com/ansible/ansible
      - name: github.com/ansible-network/collection_migration
        override-checkout: feature/network-collections
      - name: github.com/ansible-network/network_collections_migration
    timeout: 3600
    nodeset: fedora-latest-1vcpu
    vars:
      ansible_collection_repo: "github.com/ansible-collections/{{ ansible_collection_name }}"

- job:
    name: network-collections-migration-ansible-netcommon
    parent: network-collections-migration-base
    required-projects:
      - name: github.com/ansible-collections/netcommon
    vars:
      ansible_collection_namespace: ansible
      ansible_collection_name: netcommon
      proposal_project_src: ~/src/github.com/ansible-collections/netcommon
    files:
      - scenarios/ansible/netcommon/.*
      - tests/playbooks/.*
      - tools/.*

- job:
    name: network-collections-migration-cisco-asa
    parent: network-collections-migration-base
    required-projects:
      - name: github.com/ansible-collections/asa
    vars:
      ansible_collection_namespace: cisco
      ansible_collection_name: asa
    files:
      - scenarios/ansible/netcommon/.*
      - scenarios/arista/asa/.*
      - tests/playbooks/.*
      - tools/.*

- job:
    name: network-collections-migration-arista-eos
    parent: network-collections-migration-base
    required-projects:
      - name: github.com/ansible-collections/eos
    vars:
      ansible_collection_namespace: arista
      ansible_collection_name: eos
    files:
      - scenarios/ansible/netcommon/.*
      - scenarios/arista/eos/.*
      - tests/playbooks/.*
      - tools/.*

- job:
    name: network-collections-migration-checkpoint-checkpoint
    parent: network-collections-migration-base
    required-projects:
      - name: github.com/ansible-collections/checkpoint
    vars:
      ansible_collection_namespace: checkpoint
      ansible_collection_name: checkpoint
    files:
      - scenarios/ansible/netcommon/.*
      - scenarios/arista/checkpoint/.*
      - tests/playbooks/.*
      - tools/.*

- job:
    name: network-collections-migration-cisco-ios
    parent: network-collections-migration-base
    required-projects:
      - name: github.com/ansible-collections/ios
    vars:
      ansible_collection_namespace: cisco
      ansible_collection_name: ios
    files:
      - scenarios/ansible/netcommon/.*
      - scenarios/cisco/ios/.*
      - tests/playbooks/.*
      - tools/.*

- job:
    name: network-collections-migration-cisco-iosxr
    parent: network-collections-migration-base
    required-projects:
      - name: github.com/ansible-collections/iosxr
    vars:
      ansible_collection_namespace: cisco
      ansible_collection_name: iosxr
    files:
      - scenarios/ansible/netcommon/.*
      - scenarios/cisco/iosxr/.*
      - tests/playbooks/.*
      - tools/.*

- job:
    name: network-collections-migration-cisco-nxos
    parent: network-collections-migration-base
    required-projects:
      - name: github.com/ansible-collections/nxos
    vars:
      ansible_collection_namespace: cisco
      ansible_collection_name: nxos
    files:
      - scenarios/ansible/netcommon/.*
      - scenarios/cisco/nxos/.*
      - tests/playbooks/.*
      - tools/.*

- job:
    name: network-collections-migration-frr-frr
    parent: network-collections-migration-base
    required-projects:
      - name: github.com/ansible-collections/frr
    vars:
      ansible_collection_namespace: frr
      ansible_collection_name: frr
    files:
      - scenarios/ansible/netcommon/.*
      - scenarios/arista/frr/.*
      - tests/playbooks/.*
      - tools/.*

- job:
    name: network-collections-migration-junipernetworks-junos
    parent: network-collections-migration-base
    required-projects:
      - name: github.com/ansible-collections/junos
    vars:
      ansible_collection_namespace: junipernetworks
      ansible_collection_name: junos
    files:
      - scenarios/ansible/netcommon/.*
      - scenarios/junipernetworks/junos/.*
      - tests/playbooks/.*
      - tools/.*

- job:
    name: network-collections-migration-openvswitch-openvswitch
    parent: network-collections-migration-base
    required-projects:
      - name: github.com/ansible-collections/openvswitch
    vars:
      ansible_collection_namespace: openvswitch
      ansible_collection_name: openvswitch
    files:
      - scenarios/ansible/netcommon/.*
      - scenarios/openvswitch/openvswitch/.*
      - tests/playbooks/.*
      - tools/.*

- job:
    name: network-collections-migration-skydive-skydive
    parent: network-collections-migration-base
    required-projects:
      - name: github.com/ansible-collections/skydive
    vars:
      ansible_collection_namespace: skydive
      ansible_collection_name: skydive
    files:
      - scenarios/ansible/netcommon/.*
      - scenarios/skydive/skydive/.*
      - tests/playbooks/.*
      - tools/.*

- job:
    name: network-collections-migration-vyos-vyos
    parent: network-collections-migration-base
    required-projects:
      - name: github.com/ansible-collections/vyos
    vars:
      ansible_collection_namespace: vyos
      ansible_collection_name: vyos
    files:
      - scenarios/ansible/netcommon/.*
      - scenarios/vyos/vyos/.*
      - tests/playbooks/.*
      - tools/.*

- job:
    name: build-ansible-minimal
    pre-run:
      - tests/playbooks/pre.yaml
      - tests/playbooks/build-ansible-minimal/pre.yaml
    run: tests/playbooks/build-ansible-minimal/run-post.yaml
    post-run: tests/playbooks/build-ansible-minimal/post.yaml
    required-projects:
      - name: github.com/ansible-collection-migration/ansible-base
      - name: github.com/ansible-network/network_collections_migration
    timeout: 5400
    nodeset: fedora-latest-1vcpu

- job:
    name: build-ansible-base
    parent: build-ansible-minimal

- project-template:
    name: network-collections-migration
    description: |
      A common set of migration jobs used by ansible network team
    check:
      jobs:
        - build-ansible-base
        - network-collections-migration-ansible-netcommon
        - network-collections-migration-arista-eos
        - network-collections-migration-checkpoint-checkpoint
        - network-collections-migration-cisco-asa
        - network-collections-migration-cisco-ios
        - network-collections-migration-cisco-iosxr
        - network-collections-migration-cisco-nxos
        - network-collections-migration-frr-frr
        - network-collections-migration-junipernetworks-junos
        - network-collections-migration-openvswitch-openvswitch
        - network-collections-migration-skydive-skydive
        - network-collections-migration-vyos-vyos
    gate:
      queue: network-collections-migration
      jobs:
        - build-ansible-base
        - network-collections-migration-ansible-netcommon
        - network-collections-migration-arista-eos
        - network-collections-migration-checkpoint-checkpoint
        - network-collections-migration-cisco-asa
        - network-collections-migration-cisco-ios
        - network-collections-migration-cisco-iosxr
        - network-collections-migration-cisco-nxos
        - network-collections-migration-frr-frr
        - network-collections-migration-junipernetworks-junos
        - network-collections-migration-openvswitch-openvswitch
        - network-collections-migration-skydive-skydive
        - network-collections-migration-vyos-vyos
    post:
      jobs:
        - propose-network-collections-migration-cisco-asa

- project:
    templates:
      - network-collections-migration
